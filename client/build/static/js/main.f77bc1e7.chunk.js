(this["webpackJsonpcup-of-sugar"]=this["webpackJsonpcup-of-sugar"]||[]).push([[0],{181:function(e,t,n){var a=n(197),c="supersecret";e.exports={authMiddleware:function(e){var t=e.req,n=t.body.token||t.query.token||t.headers.authorization;if(t.headers.authorization&&(n=n.split(" ").pop().trim()),!n)return t;try{var r=a.verify(n,c,{maxAge:"2h"}).data;t.user=r}catch(i){console.log("Invalid token")}return t},signToken:function(e){var t={email:e.email,name:e.name,_id:e._id};return a.sign({data:t},c,{expiresIn:"2h"})}}},195:function(e,t,n){},201:function(e,t){},203:function(e,t){},216:function(e,t){},218:function(e,t){},246:function(e,t){},248:function(e,t){},249:function(e,t){},254:function(e,t){},256:function(e,t){},262:function(e,t){},264:function(e,t){},283:function(e,t){},295:function(e,t){},298:function(e,t){},315:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(180),i=n.n(r),s=(n(195),n(12)),o=n(45),l=n(6),u=n(184),j=n(326),d=n(328),b=n(325),O=n(182),h=n(9);function f(e,t){return 1===t?e:e+"s"}function m(e,t,n){return new Promise((function(a,c){var r,i,s,o=window.indexedDB.open("shop-shop",1);o.onupgradeneeded=function(e){var t=o.result;t.createObjectStore("products",{keyPath:"_id"}),t.createObjectStore("categories",{keyPath:"_id"}),t.createObjectStore("cart",{keyPath:"_id"})},o.onerror=function(e){console.log("There was an error")},o.onsuccess=function(c){switch(r=o.result,i=r.transaction(e,"readwrite"),s=i.objectStore(e),r.onerror=function(e){console.log("error",e)},t){case"put":s.put(n),a(n);break;case"get":var l=s.getAll();l.onsuccess=function(){a(l.result)};break;case"delete":s.delete(n._id);break;default:console.log("No valid method")}i.oncomplete=function(){r.close()}}}))}n(185);var p=n(20),x="UPDATE_RENTALS",g="ADD_TO_CART",v="ADD_MULTIPLE_TO_CART",y="REMOVE_FROM_CART",_="UPDATE_CART_QUANTITY",k="TOGGLE_CART",w="UPDATE_CATEGORIES",N="UPDATE_CURRENT_CATEGORY";var C=n(3),E=Object(a.createContext)(),T=(E.Provider,function(){return Object(a.useContext)(E)});var R,A,$,I,S,P=function(e){var t=T(),n=Object(h.a)(t,2),a=n[0],c=n[1],r=e.image,i=e.name,l=e._id,u=e.quantity,j=a.cart;return Object(C.jsxs)("div",{className:"card px-1 py-1",children:[Object(C.jsxs)(o.b,{to:"/rentals/".concat(l),children:[Object(C.jsx)("img",{alt:i,src:"/images/".concat(r)}),Object(C.jsx)("p",{children:i})]}),Object(C.jsx)("div",{children:Object(C.jsxs)("div",{children:[u," ",f("item",u)," available"]})}),Object(C.jsx)("button",{onClick:function(){var t=j.find((function(e){return e._id===l}));t?(c({type:_,_id:l,rentQuantity:parseInt(t.rentQuantity)+1}),m("cart","put",Object(s.a)(Object(s.a)({},t),{},{rentQuantity:parseInt(t.purchaseQuantity)+1}))):(c({type:g,rentals:Object(s.a)(Object(s.a)({},rent),{},{rentQuantity:1})}),m("cart","put",Object(s.a)(Object(s.a)({},e),{},{rentQuantity:1})))},children:"Add to rentals"})]})},q=n(186),D=n(32),Q=n(327),U=Object(Q.a)(R||(R=Object(D.a)(["\n  {\n    user {\n      firstName\n      lastName\n      rentals {\n        _id\n        items {\n          _id\n          name\n          description\n          quantity\n        }\n      }\n    }\n  }\n"]))),M=Object(Q.a)(A||(A=Object(D.a)(["\n  query getRentals($category: ID) {\n    rentals(category: $category) {\n      _id\n      name\n      description\n      quantity\n      category {\n        _id\n      }\n    }\n  }\n"]))),B=Object(Q.a)($||($=Object(D.a)(["\n  query getCheckout($reentals: [ID]!) {\n    checkout(rentals: $rentals) {\n      session\n    }\n  }\n"]))),G=(Object(Q.a)(I||(I=Object(D.a)(["\n  {\n    products {\n      _id\n      name\n      description\n      quantity\n      category {\n        name\n      }\n    }\n  }\n"]))),Object(Q.a)(S||(S=Object(D.a)(["\n  {\n    categories {\n      _id\n      name\n    }\n  }\n"]))));var L=function(){var e=T(),t=Object(h.a)(e,2),n=t[0],c=t[1],r=n.currentCategory,i=Object(q.b)(M),s=i.loading,o=i.data;return Object(a.useEffect)((function(){o?(c({type:x,rentals:o.rentals}),o.rentals.forEach((function(e){m("rentals","put",e)}))):s||m("rentals","get").then((function(e){c({type:x,rentals:e})}))}),[o,s,c]),Object(C.jsxs)("div",{className:"my-2",children:[Object(C.jsx)("h2",{children:"Available Rentals"}),n.rentals.length?Object(C.jsx)("div",{className:"flex-row",children:(r?n.rentals.filter((function(e){return e.category._id===r})):n.rentals).map((function(e){return Object(C.jsx)(P,{_id:e._id,image:e.image,name:e.name,quantity:e.quantity},e._id)}))}):Object(C.jsx)("h3",{children:"Please add Items!"})]})};var Y,z,F,J=function(){var e=T(),t=Object(h.a)(e,2),n=t[0],c=t[1],r=n.categories,i=Object(q.b)(G),s=i.loading,o=i.data;return Object(a.useEffect)((function(){o?(c({type:w,categories:o.categories}),o.categories.forEach((function(e){m("categories","put",e)}))):s||m("categories","get").then((function(e){c({type:w,categories:e})}))}),[o,s,c]),Object(C.jsxs)("div",{children:[Object(C.jsx)("h2",{children:"Rentals Category:"}),r.map((function(e){return Object(C.jsx)("button",{onClick:function(){var t;t=e._id,c({type:N,currentCategory:t})},children:e.name},e._id)}))]})},H=n(11),V=n(18),K=n(322),W=function(e){var t=e.rent,n=T(),a=Object(h.a)(n,2)[1];return Object(C.jsxs)("div",{className:"flex-row",children:[Object(C.jsx)("div",{}),Object(C.jsxs)("div",{children:[Object(C.jsxs)("div",{children:[t.name,", $",t.quantity]}),Object(C.jsxs)("div",{children:[Object(C.jsx)("span",{children:"Qty:"}),Object(C.jsx)("input",{type:"number",placeholder:"1",value:item.rentQuantity,onChange:function(e){var n=e.target.value;"0"===n?(a({type:y,_id:item._id}),m("cart","delete",Object(s.a)({},t))):(a({type:_,_id:item._id,purchaseQuantity:parseInt(n)}),m("cart","put",Object(s.a)(Object(s.a)({},t),{},{rentQuantity:parseInt(n)})))}}),Object(C.jsx)("span",{"aria-label":"trash",onClick:function(){return function(e){a({type:y,_id:item._id}),m("cart","delete",Object(s.a)({},e))}(t)},children:"\ud83d\uddd1\ufe0f"})]})]})]})},X=n(181),Z=n.n(X),ee=function(){var e=T(),t=Object(h.a)(e,2),n=t[0],c=t[1],r=Object(K.a)(B),i=Object(h.a)(r,2),s=i[0];i[1].data;function o(){c({type:k})}return Object(a.useEffect)((function(){function e(){return(e=Object(V.a)(Object(H.a)().mark((function e(){var t;return Object(H.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m("cart","get");case 2:t=e.sent,c({type:v,rentals:Object(p.a)(t)});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.cart.length||function(){e.apply(this,arguments)}()}),[n.cart.length,c]),n.cartOpen?Object(C.jsxs)("div",{className:"cart",children:[Object(C.jsx)("div",{className:"close",onClick:o,children:"[close]"}),Object(C.jsx)("h2",{children:"Your Rentals"}),n.cart.length?Object(C.jsxs)("div",{children:[n.cart.map((function(e){return Object(C.jsx)(W,{item:e},e._id)})),Z.a.loggedIn()?Object(C.jsx)("button",{onClick:function(){var e=[];n.cart.forEach((function(t){for(var n=0;n<t.rentQuantity;n++)e.push(e._id)})),s({variables:{rentals:e}})},children:"Checkout"}):Object(C.jsx)("span",{children:"Please login first!"})]}):Object(C.jsx)("h3",{children:"You have to add items first!"})]}):Object(C.jsx)("div",{className:"cart-closed",onClick:o,children:Object(C.jsx)("span",{role:"img","aria-label":"trash",children:"\ud83d\uded2"})})},te=function(){return Object(C.jsxs)("div",{className:"container",children:[Object(C.jsx)(J,{}),Object(C.jsx)(L,{}),Object(C.jsx)(ee,{})]})},ne=n(323),ae=(Object(Q.a)(Y||(Y=Object(D.a)(["\n  mutation login($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n      user {\n        _id\n      }\n    }\n  }\n"]))),Object(Q.a)(z||(z=Object(D.a)(["\n  mutation addRental($products: [ID]!) {\n    addRental(rentals: $rentals) {\n      rentals {\n        _id\n        name\n        description\n        quantity\n        category {\n          name\n        }\n      }\n    }\n  }\n"]))));Object(Q.a)(F||(F=Object(D.a)(["\n  mutation addUser(\n    $firstName: String!\n    $lastName: String!\n    $email: String!\n    $password: String!\n  ) {\n    addUser(\n      firstName: $firstName\n      lastName: $lastName\n      email: $email\n      password: $password\n    ) {\n      token\n      user {\n        _id\n      }\n    }\n  }\n"])));var ce=function(){var e=Object(ne.a)(ae),t=Object(h.a)(e,1)[0];return Object(a.useEffect)((function(){function e(){return(e=Object(V.a)(Object(H.a)().mark((function e(){var n,a,c;return Object(H.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,idbPromise("cart","get");case 2:if(n=e.sent,!n.map((function(e){return e._id})).length){e.next=11;break}return e.next=7,t({variables:{rentals:rentals}});case 7:a=e.sent,c=a.data,c.addRental.rentals.forEach((function(e){idbPromise("cart","delete",e)}));case 11:setTimeout((function(){window.location.assign("/")}),5e3);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]),Object(C.jsx)("div",{children:Object(C.jsx)(Jumbotron,{children:Object(C.jsx)("h1",{children:"Success!"})})})};var re=function(){var e,t=Object(q.b)(U).data;return t&&(e=t.user),Object(C.jsx)(C.Fragment,{children:Object(C.jsxs)("div",{className:"container my-1",children:[Object(C.jsx)(o.b,{to:"/",children:"\u2190 Back to Items"}),e?Object(C.jsxs)(C.Fragment,{children:[Object(C.jsxs)("h2",{children:["Rentals History for ",e.firstName," ",e.lastName]}),e.rentals.map((function(e){return Object(C.jsx)("div",{className:"my-2",children:Object(C.jsx)("div",{className:"flex-row",children:order.rentals.map((function(e,t){var n=e._id,a=e.image,c=e.name;return Object(C.jsx)("div",{className:"card px-1 py-1",children:Object(C.jsxs)(o.b,{to:"/rentals/".concat(n),children:[Object(C.jsx)("img",{alt:c,src:"/images/".concat(a)}),Object(C.jsx)("p",{children:c})]})},t)}))})},e._id)}))]}):null]})})},ie=Object(u.a)({uri:"/graphql"}),se=Object(O.a)((function(e,t){var n=t.headers,a=localStorage.getItem("id_token");return{headers:Object(s.a)(Object(s.a)({},n),{},{authorization:a?"Bearer ".concat(a):""})}})),oe=new j.a({link:se.concat(ie),cache:new d.a});var le=function(){return Object(C.jsx)(b.a,{client:oe,children:Object(C.jsx)(o.a,{children:Object(C.jsx)("div",{children:Object(C.jsxs)(l.c,{children:[Object(C.jsx)(l.a,{path:"/",element:Object(C.jsx)(te,{})}),Object(C.jsx)(l.a,{path:"/search",element:Object(C.jsx)(ce,{})}),Object(C.jsx)(l.a,{path:"/saved",element:Object(C.jsx)(re,{})})]})})})})};i.a.render(Object(C.jsx)(c.a.StrictMode,{children:Object(C.jsx)(le,{})}),document.getElementById("root"))}},[[315,1,2]]]);
//# sourceMappingURL=main.f77bc1e7.chunk.js.map