(this["webpackJsonpcup-of-sugar"]=this["webpackJsonpcup-of-sugar"]||[]).push([[0],{207:function(e,n,t){},212:function(e,n){},214:function(e,n){},227:function(e,n){},229:function(e,n){},257:function(e,n){},259:function(e,n){},260:function(e,n){},265:function(e,n){},267:function(e,n){},273:function(e,n){},275:function(e,n){},294:function(e,n){},306:function(e,n){},309:function(e,n){},329:function(e,n,t){"use strict";t.r(n);var a,r,c,s=t(0),i=t.n(s),o=t(39),l=t.n(o),d=(t(207),t(4)),j=t(71),u=t(7),b=t(197),O=t(344),m=t(346),p=t(341),h=t(195),x=t(11),f=t(20),v=t(15),g=t(8),w=t(343),y=t(342),k=t(338),S=t(337),q=t(89),C=t.n(q),$=t(36),_=t(345),N=(Object(_.a)(a||(a=Object($.a)(["\n  mutation login($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n      user {\n        _id\n      }\n    }\n  }\n"]))),Object(_.a)(r||(r=Object($.a)(["\n  mutation addRental($products: [ID]!) {\n    addRental(rentals: $rentals) {\n      rentals {\n        _id\n        name\n        description\n        quantity\n        category {\n          name\n        }\n      }\n    }\n  }\n"])))),F=Object(_.a)(c||(c=Object($.a)(["\n  mutation addUser(\n    $firstName: String!\n    $lastName: String!\n    $email: String!\n    $password: String!\n  ) {\n    addUser(\n      firstName: $firstName\n      lastName: $lastName\n      email: $email\n      password: $password\n    ) {\n      token\n      user {\n        _id\n      }\n    }\n  }\n"]))),I=t(3),P=function(){var e=Object(s.useState)({username:"",email:"",password:""}),n=Object(g.a)(e,2),t=n[0],a=n[1],r=Object(s.useState)(!1),c=Object(g.a)(r,1)[0],i=Object(s.useState)(!1),o=Object(g.a)(i,2),l=o[0],j=o[1],u=Object(S.a)(F),b=Object(g.a)(u,2),O=b[0],m=b[1].error,p=function(e){var n=e.target,r=n.name,c=n.value;a(Object(d.a)(Object(d.a)({},t),{},Object(v.a)({},r,c)))},h=function(){var e=Object(f.a)(Object(x.a)().mark((function e(n){var r,c;return Object(x.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),!1===n.currentTarget.checkValidity()&&(n.preventDefault(),n.stopPropagation()),e.prev=3,e.next=6,O({variables:Object(d.a)({},t)});case 6:r=e.sent,c=r.data,C.a.login(c.addUser.token),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(m),j(!0);case 15:a({username:"",email:"",password:""});case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(n){return e.apply(this,arguments)}}();return Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(w.a,{noValidate:!0,validated:c,onSubmit:h,children:[Object(I.jsx)(y.a,{dismissible:!0,onClose:function(){return j(!1)},show:l,variant:"danger",children:"Something went wrong with your signup!"}),Object(I.jsxs)(w.a.Group,{children:[Object(I.jsx)(w.a.Label,{htmlFor:"username",children:"Username"}),Object(I.jsx)(w.a.Control,{type:"text",placeholder:"Your username",name:"username",onChange:p,value:t.username,required:!0}),Object(I.jsx)(w.a.Control.Feedback,{type:"invalid",children:"Username is required!"})]}),Object(I.jsxs)(w.a.Group,{children:[Object(I.jsx)(w.a.Label,{htmlFor:"email",children:"Email"}),Object(I.jsx)(w.a.Control,{type:"email",placeholder:"Your email address",name:"email",onChange:p,value:t.email,required:!0}),Object(I.jsx)(w.a.Control.Feedback,{type:"invalid",children:"Email is required!"})]}),Object(I.jsxs)(w.a.Group,{children:[Object(I.jsx)(w.a.Label,{htmlFor:"password",children:"Password"}),Object(I.jsx)(w.a.Control,{type:"password",placeholder:"Your password",name:"password",onChange:p,value:t.password,required:!0}),Object(I.jsx)(w.a.Control.Feedback,{type:"invalid",children:"Password is required!"})]}),Object(I.jsx)(k.a,{disabled:!(t.username&&t.email&&t.password),type:"submit",variant:"success",children:"Submit"})]})})},E=function(){var e=Object(s.useState)({email:"",password:""}),n=Object(g.a)(e,2),t=n[0],a=n[1],r=Object(S.a)(LOGIN_USER),c=Object(g.a)(r,2),i=c[0],o=c[1].error,l=Object(s.useState)(!1),j=Object(g.a)(l,1)[0],u=Object(s.useState)(!1),b=Object(g.a)(u,2),O=b[0],m=b[1],p=function(e){var n=e.target,r=n.name,c=n.value;a(Object(d.a)(Object(d.a)({},t),{},Object(v.a)({},r,c)))},h=function(){var e=Object(f.a)(Object(x.a)().mark((function e(n){var r,c;return Object(x.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),!1===n.currentTarget.checkValidity()&&(n.preventDefault(),n.stopPropagation()),e.prev=3,e.next=6,i({variables:Object(d.a)({},t)});case 6:r=e.sent,c=r.data,C.a.login(c.login.token),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(o),m(!0);case 15:a({username:"",email:"",password:""});case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(n){return e.apply(this,arguments)}}();return Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)(w.a,{noValidate:!0,validated:j,onSubmit:h,children:[Object(I.jsx)(y.a,{dismissible:!0,onClose:function(){return m(!1)},show:O,variant:"danger",children:"Something went wrong with your login credentials!"}),Object(I.jsxs)(w.a.Group,{children:[Object(I.jsx)(w.a.Label,{htmlFor:"email",children:"Email"}),Object(I.jsx)(w.a.Control,{type:"text",placeholder:"Your email",name:"email",onChange:p,value:t.email,required:!0}),Object(I.jsx)(w.a.Control.Feedback,{type:"invalid",children:"Email is required!"})]}),Object(I.jsxs)(w.a.Group,{children:[Object(I.jsx)(w.a.Label,{htmlFor:"password",children:"Password"}),Object(I.jsx)(w.a.Control,{type:"password",placeholder:"Your password",name:"password",onChange:p,value:t.password,required:!0}),Object(I.jsx)(w.a.Control.Feedback,{type:"invalid",children:"Password is required!"})]}),Object(I.jsx)(k.a,{disabled:!(t.email&&t.password),type:"submit",variant:"success",children:"Submit"})]})})},D=function(){return Object(I.jsxs)("div",{children:[Object(I.jsx)(P,{}),Object(I.jsx)(E,{})]})};var G,L,R,U,Y,T=function(){var e=Object(S.a)(N),n=Object(g.a)(e,1)[0];return Object(s.useEffect)((function(){function e(){return(e=Object(f.a)(Object(x.a)().mark((function e(){var t,a,r;return Object(x.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,idbPromise("cart","get");case 2:if(t=e.sent,!t.map((function(e){return e._id})).length){e.next=11;break}return e.next=7,n({variables:{rentals:rentals}});case 7:a=e.sent,r=a.data,r.addRental.rentals.forEach((function(e){idbPromise("cart","delete",e)}));case 11:setTimeout((function(){window.location.assign("/")}),5e3);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[n]),Object(I.jsx)("div",{children:Object(I.jsx)(Jumbotron,{children:Object(I.jsx)("h1",{children:"Success!"})})})},V=t(348),z=Object(_.a)(G||(G=Object($.a)(["\n  {\n    user {\n      firstName\n      lastName\n      rentals {\n        _id\n        items {\n          _id\n          name\n          description\n          quantity\n        }\n      }\n    }\n  }\n"])));Object(_.a)(L||(L=Object($.a)(["\n  query getRentals($category: ID) {\n    rentals(category: $category) {\n      _id\n      name\n      description\n      quantity\n      category {\n        _id\n      }\n    }\n  }\n"]))),Object(_.a)(R||(R=Object($.a)(["\n  query getCheckout($reentals: [ID]!) {\n    checkout(rentals: $rentals) {\n      session\n    }\n  }\n"]))),Object(_.a)(U||(U=Object($.a)(["\n  {\n    products {\n      _id\n      name\n      description\n      quantity\n      category {\n        name\n      }\n    }\n  }\n"]))),Object(_.a)(Y||(Y=Object($.a)(["\n  {\n    categories {\n      _id\n      name\n    }\n  }\n"])));var B=function(){var e,n=Object(V.a)(z).data;return n&&(e=n.user),Object(I.jsx)(I.Fragment,{children:Object(I.jsxs)("div",{className:"container my-1",children:[Object(I.jsx)(j.b,{to:"/",children:"\u2190 Back to Items"}),e?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsxs)("h2",{children:["Rentals History for ",e.firstName," ",e.lastName]}),e.rentals.map((function(e){return Object(I.jsx)("div",{className:"my-2",children:Object(I.jsx)("div",{className:"flex-row",children:order.rentals.map((function(e,n){var t=e._id,a=e.image,r=e.name;return Object(I.jsx)("div",{className:"card px-1 py-1",children:Object(I.jsxs)(j.b,{to:"/rentals/".concat(t),children:[Object(I.jsx)("img",{alt:r,src:"/images/".concat(a)}),Object(I.jsx)("p",{children:r})]})},n)}))})},e._id)}))]}):null]})})},J=Object(b.a)({uri:"/graphql"}),M=Object(h.a)((function(e,n){var t=n.headers,a=localStorage.getItem("id_token");return{headers:Object(d.a)(Object(d.a)({},t),{},{authorization:a?"Bearer ".concat(a):""})}})),A=new O.a({link:M.concat(J),cache:new m.a});var H=function(){return Object(I.jsx)(p.a,{client:A,children:Object(I.jsx)(j.a,{children:Object(I.jsx)("div",{children:Object(I.jsxs)(u.c,{children:[Object(I.jsx)(u.a,{path:"/",element:Object(I.jsx)(D,{})}),Object(I.jsx)(u.a,{path:"/search",element:Object(I.jsx)(T,{})}),Object(I.jsx)(u.a,{path:"/saved",element:Object(I.jsx)(B,{})}),Object(I.jsx)(u.a,{path:"/post",element:Object(I.jsx)(Post,{})})]})})})})};l.a.render(Object(I.jsx)(i.a.StrictMode,{children:Object(I.jsx)(H,{})}),document.getElementById("root"))},89:function(e,n,t){var a=t(208),r="supersecret";e.exports={authMiddleware:function(e){var n=e.req,t=n.body.token||n.query.token||n.headers.authorization;if(n.headers.authorization&&(t=t.split(" ").pop().trim()),!t)return n;try{var c=a.verify(t,r,{maxAge:"2h"}).data;n.user=c}catch(s){console.log("Invalid token")}return n},signToken:function(e){var n={email:e.email,name:e.name,_id:e._id};return a.sign({data:n},r,{expiresIn:"2h"})}}}},[[329,1,2]]]);
//# sourceMappingURL=main.9c2e8fd0.chunk.js.map